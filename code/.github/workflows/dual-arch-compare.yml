name: Dual-Architecture Compare Builds

on:
  push:
    paths:
      - 'ch*/**'
      - 'core/**'
      - 'core/scripts/ci/run_compare_builds.sh'
      - 'docs/dual_arch_builds.md'
      - '.github/workflows/dual-arch-compare.yml'
  pull_request:
    paths:
      - 'ch*/**'
      - 'core/**'
      - 'core/scripts/ci/run_compare_builds.sh'
      - 'docs/dual_arch_builds.md'
      - '.github/workflows/dual-arch-compare.yml'

jobs:
  compare-builds:
    runs-on: ubuntu-latest
    container:
      image: nvidia/cuda:13.0.0-devel-ubuntu22.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install build dependencies
        run: |
          apt-get update
          apt-get install -y --no-install-recommends build-essential make python3

      - name: Run dual-architecture compare builds
        run: |
          bash core/scripts/ci/run_compare_builds.sh
